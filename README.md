# HYPEè§£é”ä¸åˆçº¦ç›‘æ§ç³»ç»Ÿ

å®æ—¶ç›‘æ§Hyperliquidä¸Šçš„HYPEä»£å¸è§£é”è½¬è´¦å’Œåˆçº¦äº¤æ˜“ä¿¡å·ï¼Œé€šè¿‡Webhookæä¾›æ¯«ç§’çº§é¢„è­¦ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

### ğŸ”„ è½¬è´¦ç›‘æ§
- **å®æ—¶ç›‘æ§**: 26ä¸ªæŒ‡å®šé’±åŒ…åœ°å€çš„HYPEä»£å¸è½¬å…¥/è½¬å‡ºæ“ä½œ
- **æ™ºèƒ½é¢„è­¦**: å•ç¬”â‰¥10,000 HYPE å’Œ 24å°æ—¶ç´¯è®¡â‰¥50,000 HYPE
- **å»é‡å¤„ç†**: 24å°æ—¶çª—å£å†…é¿å…é‡å¤è­¦æŠ¥

### ğŸ“Š åˆçº¦äº¤æ˜“ç›‘æ§ (NEW!)
- **å¤šç§ç›‘æ§æ¨¡å¼**: WebSocketå®æ—¶ç›‘æ§ + RPCè½®è¯¢ç›‘æ§
- **äº¤æ˜“å‘˜è·Ÿè¸ª**: ç›‘æ§æŒ‡å®šäº¤æ˜“å‘˜çš„åˆçº¦å¼€ä»“/å¹³ä»“ä¿¡å·  
- **æ™ºèƒ½èšåˆ**: RPCæ¨¡å¼è‡ªåŠ¨èšåˆå¤§è®¢å•å­æˆäº¤ï¼Œé¿å…é‡å¤è­¦æŠ¥
- **åœ°å€éªŒè¯**: ä¸¥æ ¼éªŒè¯äº¤æ˜“å‘˜åœ°å€ï¼Œé¿å…è¯¯æŠ¥
- **å¤šç©ºè¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å¼€å¤šã€å¼€ç©ºã€å¹³ä»“æ“ä½œ
- **ä»·å€¼ç­›é€‰**: æ”¯æŒæœ€å°åä¹‰ä»·å€¼é˜ˆå€¼è¿‡æ»¤
- **èµ„äº§è¿‡æ»¤**: å¯é…ç½®ç›‘æ§ç‰¹å®šèµ„äº§ï¼ˆBTCã€ETHç­‰ï¼‰

### ğŸ”” é€šçŸ¥ç³»ç»Ÿ
- **åŒWebhookæ”¯æŒ**: è½¬è´¦ç›‘æ§å’Œåˆçº¦ç›‘æ§ä½¿ç”¨ç‹¬ç«‹Webhook
- **é‡è¯•æœºåˆ¶**: æ”¯æŒé‡è¯•çš„å®æ—¶é€šçŸ¥
- **è¯¦ç»†æ ¼å¼åŒ–**: ç»“æ„åŒ–çš„è­¦æŠ¥æ¶ˆæ¯æ ¼å¼

### ğŸ›  æŠ€æœ¯ç‰¹æ€§
- **Redisç¼“å­˜**: é«˜æ•ˆçš„æ•°æ®ç¼“å­˜å’Œç»Ÿè®¡
- **å®¹é”™è®¾è®¡**: è‡ªåŠ¨é‡è¿å’Œé”™è¯¯æ¢å¤
- **å¹¶è¡Œç›‘æ§**: è½¬è´¦ä¸åˆçº¦ç›‘æ§åŒæ—¶å·¥ä½œ

## ğŸ“ é¡¹ç›®ç»“æ„

```
hyper-unstaking-monitor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â””â”€â”€ alert-engine.ts      # é¢„è­¦å¼•æ“
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ hyperliquid-monitor.ts # Hyperliquid WebSocketç›‘æ§
â”‚   â”‚   â”œâ”€â”€ webSocketContractMonitor.ts # WebSocketåˆçº¦ç›‘æ§
â”‚   â”‚   â”œâ”€â”€ pooledWebSocketContractMonitor.ts # è¿æ¥æ± WebSocketç›‘æ§
â”‚   â”‚   â”œâ”€â”€ robustWebSocketContractMonitor.ts # ç¨³å¥WebSocketç›‘æ§
â”‚   â”‚   â””â”€â”€ rpcContractMonitor.ts # RPCè½®è¯¢åˆçº¦ç›‘æ§ (æ¨è)
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ helpers.ts           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ cache.ts                 # Redisç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ config.ts                # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ logger.ts                # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ types.ts                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ webhook.ts               # Webhooké€šçŸ¥ (æ”¯æŒåŒWebhook)
â”‚   â””â”€â”€ index.ts                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ contractMonitor.test.ts  # åˆçº¦ç›‘æ§æµ‹è¯•
â”œâ”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docker-compose.yml           # Rediså®¹å™¨é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

> ğŸ’¡ **æ–°ç”¨æˆ·æ¨è**ï¼šæŸ¥çœ‹ [å¿«é€Ÿå¯åŠ¨æŒ‡å—](./quick-start.md) è·å–è¯¦ç»†çš„ä¸€é”®å¯åŠ¨æ•™ç¨‹  
> ğŸŒ¥ï¸ **äº‘ç«¯éƒ¨ç½²**ï¼šå¦‚é‡ç«¯å£å†²çªæˆ–npmé—®é¢˜ï¼ŒæŸ¥çœ‹ [äº‘ç«¯éƒ¨ç½²æŒ‡å—](./CLOUD-DEPLOY.md)

### æ–¹æ³•ä¸€ï¼šä¸€é”®å¿«é€Ÿå¯åŠ¨ (æ¨è)

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®Webhook URLç­‰å‚æ•°

# 2. ä¸€é”®å¯åŠ¨ (è‡ªåŠ¨å®Œæˆï¼šå®‰è£…ä¾èµ– â†’ æ„å»º â†’ Dockeræ‰“åŒ… â†’ å¯åŠ¨)
./manage.sh quick

# 3. æŸ¥çœ‹æ—¥å¿—
./manage.sh logs

# 4. æŸ¥çœ‹çŠ¶æ€
./manage.sh status
```

### æ–¹æ³•äºŒï¼šä¼ ç»Ÿå¯åŠ¨æ–¹å¼

#### 1. å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

#### 2. æ„å»ºé¡¹ç›®
```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm build

# æˆ–ä½¿ç”¨ npm
npm run build
```

#### 3. Docker å¯åŠ¨
```bash
# æ„å»º Docker é•œåƒ
docker-compose build hype-monitor

# å¯åŠ¨æœåŠ¡
docker-compose up -d hype-monitor

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f hype-monitor
```

### æ–¹æ³•ä¸‰ï¼šå¼€å‘æ¨¡å¼

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å¯åŠ¨RedisæœåŠ¡
npm run docker:up

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 4. å¯åŠ¨å¼€å‘æ¨¡å¼
npm run dev
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `WEBHOOK_URL` | è½¬è´¦ç›‘æ§Webhooké€šçŸ¥åœ°å€ | - |
| `CONTRACT_WEBHOOK_URL` | åˆçº¦ç›‘æ§Webhooké€šçŸ¥åœ°å€ | - |
| `REDIS_URL` | Redisè¿æ¥åœ°å€ | `redis://localhost:6379` |
| `SINGLE_TRANSFER_THRESHOLD` | å•ç¬”è½¬è´¦é¢„è­¦é˜ˆå€¼ | `10000` |
| `DAILY_CUMULATIVE_THRESHOLD` | 24å°æ—¶ç´¯è®¡é¢„è­¦é˜ˆå€¼ | `50000` |
| `CONTRACT_MONITORING_ENABLED` | æ˜¯å¦å¯ç”¨åˆçº¦ç›‘æ§ | `false` |
| `CONTRACT_MIN_NOTIONAL` | åˆçº¦ç›‘æ§æœ€å°åä¹‰ä»·å€¼ | `1000` |
| `CONTRACT_ASSETS` | ç›‘æ§çš„èµ„äº§åˆ—è¡¨(é€—å·åˆ†éš”) | å…¨éƒ¨èµ„äº§ |
| `CONTRACT_MONITOR_TYPE` | åˆçº¦ç›‘æ§å™¨ç±»å‹ | `rpc` |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | `info` |

### åˆçº¦ç›‘æ§å™¨ç±»å‹

| ç±»å‹ | è¯´æ˜ | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| `rpc` | RPCè½®è¯¢ç›‘æ§å™¨ | ç¨³å®šæ€§é«˜ï¼Œæ™ºèƒ½èšåˆè®¢å•ï¼Œé¿å…é‡å¤è­¦æŠ¥ | **æ¨è** - ç”Ÿäº§ç¯å¢ƒ |
| `robust` | ç¨³å¥WebSocketç›‘æ§å™¨ | å®æ—¶æ€§å¥½ï¼Œè¿æ¥ç¨³å®šæ€§ä¼˜åŒ– | å¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ |
| `pooled` | è¿æ¥æ± WebSocketç›‘æ§å™¨ | æ”¯æŒæ›´å¤šäº¤æ˜“å‘˜ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ | ç›‘æ§å¤§é‡äº¤æ˜“å‘˜ |
| `single` | å•è¿æ¥WebSocketç›‘æ§å™¨ | ç®€å•æ˜“ç”¨ï¼Œèµ„æºæ¶ˆè€—ä½ | ç›‘æ§å°‘é‡äº¤æ˜“å‘˜ |

### ç›‘æ§åœ°å€

#### è½¬è´¦ç›‘æ§
ç³»ç»Ÿç›‘æ§26ä¸ªé¢„è®¾åœ°å€ï¼ŒåŒ…æ‹¬ï¼š
- ä¸»è¦è§£é”åœ°å€ (2,381,375.14 HYPE)
- 25ä¸ªå…¶ä»–è§£é”åœ°å€
- æ”¯æŒè‡ªå®šä¹‰é¢„è­¦é˜ˆå€¼

#### åˆçº¦ç›‘æ§ (NEW!)
ç›‘æ§4ä¸ªæŒ‡å®šäº¤æ˜“å‘˜åœ°å€ï¼š
- 0xfa6af5f4f7440ce389a1e650991eea45c161e13e
- 0xa04a4b7b7c37dbd271fdc57618e9cb9836b250bf  
- 0xb8b9e3097c8b1dddf9c5ea9d48a7ebeaf09d67d2
- 0xd5ff5491f6f3c80438e02c281726757baf4d1070

## ğŸ“Š é¢„è­¦è§„åˆ™

### 1. è½¬è´¦é¢„è­¦
#### å•ç¬”è½¬è´¦é¢„è­¦
- **æ¡ä»¶**: å•ç¬”è½¬å…¥/è½¬å‡º â‰¥ 10,000 HYPE
- **é€šçŸ¥**: ç«‹å³å‘é€åˆ°è½¬è´¦Webhook

#### 24å°æ—¶ç´¯è®¡é¢„è­¦
- **æ¡ä»¶**: 24å°æ—¶ç´¯è®¡è½¬å…¥/è½¬å‡º â‰¥ 50,000 HYPE  
- **é€šçŸ¥**: ç«‹å³å‘é€åˆ°è½¬è´¦Webhook

### 2. åˆçº¦äº¤æ˜“é¢„è­¦ (NEW!)
#### å¼€ä»“ä¿¡å·
- **æ¡ä»¶**: ç›‘æ§åœ°å€å¼€å¤šä»“/å¼€ç©ºä»“
- **è¿‡æ»¤**: åä¹‰ä»·å€¼ â‰¥ $1,000
- **é€šçŸ¥**: ç«‹å³å‘é€åˆ°åˆçº¦Webhook

#### å¹³ä»“ä¿¡å·
- **æ¡ä»¶**: ç›‘æ§åœ°å€å¹³ä»“æ“ä½œ
- **è¿‡æ»¤**: åä¹‰ä»·å€¼ â‰¥ $1,000  
- **é€šçŸ¥**: ç«‹å³å‘é€åˆ°åˆçº¦Webhook

### 2. ç´¯è®¡è½¬è´¦é¢„è­¦
- **æ¡ä»¶**: 24å°æ—¶ç´¯è®¡è½¬å…¥/è½¬å‡º â‰¥ 50,000 HYPE
- **é€šçŸ¥**: ç«‹å³å‘é€Webhook
- **é‡ç½®**: æ¯æ—¥UTC 00:00è‡ªåŠ¨é‡ç½®

## ğŸ“¡ Webhooké€šçŸ¥æ ¼å¼

```json
{
  "timestamp": 1672531200000,
  "alertType": "single_transfer_in",
  "address": "0x5d83bb3313240cab65e2e9200d3aaf3520474fb6",
  "addressLabel": "ä¸»è¦è§£é”åœ°å€",
  "amount": "25000",
  "txHash": "0xabc123...",
  "blockTime": 1672531180000,
  "unlockAmount": 2381375.14,
  "cumulativeToday": "75000"
}
```

### é¢„è­¦ç±»å‹
- `single_transfer_in`: å•ç¬”è½¬å…¥é¢„è­¦
- `single_transfer_out`: å•ç¬”è½¬å‡ºé¢„è­¦
- `cumulative_transfer_in`: ç´¯è®¡è½¬å…¥é¢„è­¦
- `cumulative_transfer_out`: ç´¯è®¡è½¬å‡ºé¢„è­¦

## ğŸ›  å¼€å‘å’Œç»´æŠ¤

### ç®¡ç†è„šæœ¬ä½¿ç”¨

#### ğŸš€ å¿«é€Ÿå‘½ä»¤
```bash
./manage.sh quick          # ä¸€é”®å¿«é€Ÿå¯åŠ¨ (æ¨è)
./manage.sh logs           # æŸ¥çœ‹å®æ—¶æ—¥å¿—
./manage.sh status         # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./manage.sh stop           # åœæ­¢æœåŠ¡
./manage.sh restart        # é‡å¯æœåŠ¡
```

#### ğŸ³ Docker å‘½ä»¤
```bash
./manage.sh docker:build   # æ„å»ºDockeré•œåƒ
./manage.sh docker:up      # å¯åŠ¨DockeræœåŠ¡
./manage.sh docker:down    # åœæ­¢DockeræœåŠ¡
./manage.sh docker:restart # é‡å¯DockeræœåŠ¡
./manage.sh docker:logs    # æŸ¥çœ‹Dockeræ—¥å¿—
./manage.sh docker:status  # æŸ¥çœ‹DockerçŠ¶æ€
./manage.sh docker:clean   # æ¸…ç†Dockerèµ„æº
```

#### âš™ï¸ ä¼ ç»Ÿå‘½ä»¤
```bash
./manage.sh dev            # å¯åŠ¨å¼€å‘ç¯å¢ƒ
./manage.sh build          # æ„å»ºé¡¹ç›®
./manage.sh install        # å®‰è£…ä¾èµ–
./manage.sh deploy         # éƒ¨ç½²åº”ç”¨
./manage.sh clean          # æ¸…ç†æ„å»ºæ–‡ä»¶
```

### npm è„šæœ¬å‘½ä»¤
```bash
npm run dev          # å¼€å‘æ¨¡å¼å¯åŠ¨
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm start            # ç”Ÿäº§æ¨¡å¼å¯åŠ¨
npm run docker:up    # å¯åŠ¨Rediså®¹å™¨
npm run docker:down  # åœæ­¢Rediså®¹å™¨
npm run docker:logs  # æŸ¥çœ‹å®¹å™¨æ—¥å¿—
```

### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/hype-monitor.log

# æŸ¥çœ‹Dockerå®¹å™¨æ—¥å¿—
npm run docker:logs
```

### ç³»ç»ŸçŠ¶æ€
ç³»ç»Ÿæ¯5åˆ†é’Ÿè¾“å‡ºçŠ¶æ€æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- è¿è¡Œæ—¶é•¿
- WebSocketè¿æ¥çŠ¶æ€
- è®¢é˜…æ•°é‡
- ç›‘æ§åœ°å€æ•°é‡
- æ´»è·ƒè§„åˆ™æ•°é‡

## ğŸ”§ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: TypeScript/Node.js
- **WebSocket**: @nktkas/hyperliquid
- **ç¼“å­˜**: Redis 7
- **é€šçŸ¥**: Axios HTTPè¯·æ±‚
- **æ—¥å¿—**: Winston
- **å®¹å™¨**: Docker Compose

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **WebSocketè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤Hyperliquid APIå¯è®¿é—®
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¿æ¥é”™è¯¯ä¿¡æ¯

2. **Redisè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥Rediså®¹å™¨çŠ¶æ€
   docker ps
   
   # é‡å¯Redis
   npm run docker:down && npm run docker:up
   ```

3. **Webhookå‘é€å¤±è´¥**
   - éªŒè¯Webhook URLé…ç½®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹é‡è¯•æ—¥å¿—

4. **å†…å­˜ä½¿ç”¨è¿‡é«˜**
   - æ£€æŸ¥Redisç¼“å­˜å¤§å°
   - ç›‘æ§WebSocketè¿æ¥æ•°é‡
   - è€ƒè™‘è°ƒæ•´æ—¥å¿—çº§åˆ«

### æ€§èƒ½ä¼˜åŒ–

- **ç›‘æ§å»¶è¿Ÿ**: ç³»ç»Ÿè®¾è®¡ç›®æ ‡ <1ç§’å“åº”æ—¶é—´
- **WebSocketç®¡ç†**: è‡ªåŠ¨é‡è¿å’Œè®¢é˜…æ¢å¤
- **ç¼“å­˜ç­–ç•¥**: 25å°æ—¶TTLè‡ªåŠ¨æ¸…ç†
- **é”™è¯¯å¤„ç†**: å®Œæ•´çš„å¼‚å¸¸æ•è·å’Œæ¢å¤

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

ç³»ç»Ÿæä¾›ä»¥ä¸‹ç›‘æ§æŒ‡æ ‡ï¼š
- WebSocketè¿æ¥çŠ¶æ€
- è®¢é˜…æ•°é‡
- å¤„ç†çš„äº‹ä»¶æ•°é‡
- ç¼“å­˜å‘½ä¸­ç‡
- WebhookæˆåŠŸç‡
- ç³»ç»Ÿè¿è¡Œæ—¶é•¿

## ğŸ”’ å®‰å…¨è€ƒè™‘

- æ‰€æœ‰æ•æ„Ÿé…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- Redisè¿æ¥ä½¿ç”¨å¯†ç ä¿æŠ¤ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- Webhookè¯·æ±‚åŒ…å«ç³»ç»Ÿæ ‡è¯†
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—è®°å½•

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹é¡¹ç›®æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚